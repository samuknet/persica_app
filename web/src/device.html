<!doctype html>
<html>
    <head>
        <title>
            Bootstrap HTML5 Skeleton
        </title>
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

        <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

        <meta charset="utf-8" />
    </head>
    <body>
        <div class="container">
            <h1>IOT Device Emulator</h1>
            <div id="didF">

            </div>

            <form class="form">
                <fielset class="form-group">
                    <label for="cmdF">Register Cmd:</label> <input class="form-control" type="text" id="cmdF" />
                </fielset>

                <fieldset class="form-group">
                    <label for="varHandleF">Register variable name:</label> <input class="form-control" type="text" id="varNameF" />
                    <label for="varValueF">Register variable value:</label> <input class="form-control" type="text" id="varValueF" />
                </fieldset>

            </form>


        </div>
    </body>
</html>


<div id="output">

</div>
<audio src="/song" id="audio" />
<script>
    var audio = document.getElementById('audio');

    // oscillator.start(context.currentTime);
    function out(msg) {
        document.getElementById('output').style.backgroundColor = msg;
    }

    var did = 500;
    
    var cmdF = document.getElementById('cmdF');
    var varHandleF = document.getElementById('varNameF');
    var varValueF = document.getElementById('varValueF');

    var didF = document.getElementById('didF');

    didF.innerHTML = 'DID: ' + did;

    var socket = io('/device?did=' + did);
    socket.on('cmd', function (data) {
        out(data.cmd);
    });
    
     cmdF.addEventListener('keydown', function (evt) {
        if (evt.keyCode === 13) {
            socket.emit('device-register-cmd', {cmd: cmdF.value});
        }
    });

     varValueF.addEventListener('keydown', function (evt) {
        if (evt.keyCode === 13) {
            socket.emit('device-updateVariable', {handle: varHandleF.value, value : varValueF.value})
        };

     });

    socket.emit('device-register-cmd', {cmd: 'play'});
    socket.on('cmd', function (data) {
        if (data.cmd === 'play') {
            audio.play();
        };
    });

</script>
</body>
</html>